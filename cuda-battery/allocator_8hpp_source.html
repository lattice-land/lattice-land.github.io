<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cuda battery library: include/battery/allocator.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Cuda battery library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('allocator_8hpp_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">allocator.hpp</div></div>
</div><!--header-->
<div class="contents">
<a href="allocator_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2021 Pierre Talbot</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#ifndef CUDA_BATTERY_ALLOCATOR_HPP</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#define CUDA_BATTERY_ALLOCATOR_HPP</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"></span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">/** \file allocator.hpp</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">We provide several allocators compatible with the data structures provided by this library.</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">The allocators are aimed to be used to distinguish in which memory (shared, global, managed or the &quot;standard&quot; C++ memory) we should allocate data.</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">This allows us to provide uniform interfaces for both host (C++) and device (CUDA) code.</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"></span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">As a general comment, be careful to always deallocate the memory from the side you allocated it, e.g., do not allocate on the host then try to deallocate it on the device.</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">To avoid these kind of mistakes, you should use `battery::shared_ptr` when passing data to a CUDA kernel, see the manual for examples.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">*/</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;type_traits&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="utility_8hpp.html">utility.hpp</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacebattery.html">battery</a> {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment"></span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">/** This allocator call the standard `malloc` and `free` functions. */</span></div>
<div class="foldopen" id="foldopen00025" data-start="{" data-end="};">
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="classbattery_1_1standard__allocator.html">   25</a></span><span class="keyword">class </span><a class="code hl_class" href="classbattery_1_1standard__allocator.html">standard_allocator</a> {</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00027" data-start="{" data-end="}">
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="classbattery_1_1standard__allocator.html#af9afc67980d82a6a03873125cacc2b80">   27</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* <a class="code hl_function" href="classbattery_1_1standard__allocator.html#af9afc67980d82a6a03873125cacc2b80">allocate</a>(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>    <span class="keywordflow">if</span>(bytes == 0) {</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    }</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <span class="keywordflow">return</span> std::malloc(bytes);</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>  }</div>
</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="foldopen" id="foldopen00034" data-start="{" data-end="}">
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="classbattery_1_1standard__allocator.html#aa718ff577c1ebfa1088dc182a89d3a4d">   34</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> <a class="code hl_function" href="classbattery_1_1standard__allocator.html#aa718ff577c1ebfa1088dc182a89d3a4d">deallocate</a>(<span class="keywordtype">void</span>* data) {</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    std::free(data);</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>  }</div>
</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno"><a class="line" href="classbattery_1_1standard__allocator.html#ae2ec671ca402535a48e2a02d8aad22c0">   38</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">bool</span> <a class="code hl_function" href="classbattery_1_1standard__allocator.html#ae2ec671ca402535a48e2a02d8aad22c0">operator==</a>(<span class="keyword">const</span> <a class="code hl_class" href="classbattery_1_1standard__allocator.html">standard_allocator</a>&amp;)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>};</div>
</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>} <span class="comment">// namespace battery</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="foldopen" id="foldopen00042" data-start="{" data-end="}">
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="allocator_8hpp.html#a6a53db3c8c991b735dd17fc0a8207d83">   42</a></span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> bytes, <a class="code hl_class" href="classbattery_1_1standard__allocator.html">battery::standard_allocator</a>&amp; p) {</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  <span class="keywordflow">return</span> p.allocate(bytes);</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>}</div>
</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="foldopen" id="foldopen00046" data-start="{" data-end="}">
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="allocator_8hpp.html#af84b7183a6198885578e7d8622adc8ee">   46</a></span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span>* ptr, <a class="code hl_class" href="classbattery_1_1standard__allocator.html">battery::standard_allocator</a>&amp; p) {</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>  <span class="keywordflow">return</span> p.deallocate(ptr);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>}</div>
</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">#ifdef __CUDACC__</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacebattery.html">battery</a> {</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment"></span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">/** An allocator using the global memory of CUDA.</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">This can be used from both the host and device side, but the memory can only be accessed when in a device function.</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="comment">Beware that allocation and deallocation must occur on the same side. */</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="keyword">class </span>global_allocator {</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">if</span>(bytes == 0) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    }</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>      <span class="keywordtype">void</span>* data = std::malloc(bytes);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>      <span class="keywordflow">if</span> (data == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        printf(<span class="stringliteral">&quot;Allocation of device memory failed\n&quot;</span>);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>      }</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>      <span class="keywordflow">return</span> data;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>      <span class="keywordtype">void</span>* data = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>      cudaError_t rc = cudaMalloc(&amp;data, bytes);</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Allocation of global memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>      }</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>      <span class="keywordflow">return</span> data;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>  }</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> deallocate(<span class="keywordtype">void</span>* data) {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>      std::free(data);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>      cudaError_t rc = cudaFree(data);</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Free of global memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>      }</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>  }</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacebattery.html#af20bf52da412236ddfa5a22bde3f50e6">operator==</a>(<span class="keyword">const</span> global_allocator&amp;)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>};</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="comment"></span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">/** An allocator using the managed memory of CUDA when the memory is allocated on the host. */</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="keyword">class </span>managed_allocator {</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>      printf(<span class="stringliteral">&quot;Managed memory cannot be allocated in device functions.\n&quot;</span>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>      assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>      <span class="keywordflow">if</span>(bytes == 0) {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>      }</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>      <span class="keywordtype">void</span>* data = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      cudaError_t rc = cudaMallocManaged(&amp;data, bytes);</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Allocation of managed memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>      }</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>      <span class="keywordflow">return</span> data;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  }</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> deallocate(<span class="keywordtype">void</span>* data) {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>      printf(<span class="stringliteral">&quot;Managed memory cannot be freed in device functions.\n&quot;</span>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>      assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>      cudaError_t rc = cudaFree(data);</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Free of managed memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>      }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>  }</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacebattery.html#af20bf52da412236ddfa5a22bde3f50e6">operator==</a>(<span class="keyword">const</span> managed_allocator&amp;)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>};</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment"></span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">/** An allocator using pinned memory for shared access between the host and the device.</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment"> * This type of memory is required on Microsoft Windows, on the Windows Subsystem for Linux (WSL), and on NVIDIA GRID (virtual GPU), because these systems do not support concurrent access to managed memory while a CUDA kernel is running.</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment"> *</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment"> * This allocator requires that you first set cudaDeviceMapHost using  cudaSetDeviceFlags.</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment"> *</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment"> * We suppose unified virtual addressing (UVA) is enabled (the property `unifiedAddressing` is true).</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment"> *</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment"> * We delegate the allocation to `global_allocator` when the allocation is done on the device, since host memory cannot be allocated in device functions.</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="comment"> * */</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="keyword">class </span>pinned_allocator {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>      <span class="keywordflow">return</span> global_allocator{}.allocate(bytes);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>      <span class="keywordflow">if</span>(bytes == 0) {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>      <span class="keywordtype">void</span>* data = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      cudaError_t rc = cudaMallocHost(&amp;data, bytes); <span class="comment">// pinned</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Allocation of pinned memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>      }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>      <span class="keywordflow">return</span> data;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>  }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> deallocate(<span class="keywordtype">void</span>* data) {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span><span class="preprocessor">    #ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>      <span class="keywordflow">return</span> global_allocator{}.deallocate(data);</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="preprocessor">    #else</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>      cudaError_t rc = cudaFreeHost(data);</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>      <span class="keywordflow">if</span> (rc != cudaSuccess) {</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;Free of pinned memory failed: &quot;</span> &lt;&lt; cudaGetErrorString(rc) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>      }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="preprocessor">    #endif</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  }</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacebattery.html#af20bf52da412236ddfa5a22bde3f50e6">operator==</a>(<span class="keyword">const</span> pinned_allocator&amp;)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>};</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>} <span class="comment">// namespace battery</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> bytes, battery::managed_allocator&amp; p) {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  <span class="keywordflow">return</span> p.allocate(bytes);</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>}</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span>* ptr, battery::managed_allocator&amp; p) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <span class="keywordflow">return</span> p.deallocate(ptr);</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>}</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> bytes, battery::global_allocator&amp; p) {</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>  <span class="keywordflow">return</span> p.allocate(bytes);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>}</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span>* ptr, battery::global_allocator&amp; p) {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  p.deallocate(ptr);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>}</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> bytes, battery::pinned_allocator&amp; p) {</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  <span class="keywordflow">return</span> p.allocate(bytes);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>}</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span>* ptr, battery::pinned_allocator&amp; p) {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>  p.deallocate(ptr);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>}</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="preprocessor">#endif </span><span class="comment">// __CUDACC__</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacebattery.html">battery</a> {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="keyword">namespace </span>impl {</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="preprocessor">#ifdef __CUDA_ARCH__</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>  __constant__</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> power2[17] = {0, 1, 2, 2, 4, 4, 4, 4, 8, 8, 8, 8, 8, 8, 8, 8, 16};</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment"></span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">/** An allocator allocating memory from a pool of memory.</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">The memory can for instance be the CUDA shared memory.</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">This allocator is incomplete as it never frees the memory allocated.</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">It allocates a control block using the &quot;normal&quot; `operator new`, where the address to the pool, its capacity and current offset are stored.</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00215" data-start="{" data-end="};">
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html">  215</a></span><span class="keyword">class </span><a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a> {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="keyword">struct </span>control_block {</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mem;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordtype">size_t</span> capacity;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="keywordtype">size_t</span> offset;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordtype">size_t</span> alignment;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordtype">size_t</span> num_deallocations;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="keywordtype">size_t</span> num_allocations;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordtype">size_t</span> unaligned_wasted_bytes;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="keywordtype">size_t</span> counter;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> control_block(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mem, <span class="keywordtype">size_t</span> capacity, <span class="keywordtype">size_t</span> alignment)</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>     : mem(mem), capacity(capacity), offset(0), alignment(alignment), num_deallocations(0), num_allocations(0), unaligned_wasted_bytes(0), counter(1)</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    {}</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>      <span class="comment">// printf(&quot;%p: allocate %lu bytes / %lu offset / %lu capacity / %lu alignment / %p current mem\n&quot;, mem, bytes, offset, capacity, alignment, &amp;mem[offset]);</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>      <span class="keywordflow">if</span>(bytes == 0) {</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>      }</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>      <span class="keywordtype">size_t</span> smallest_alignment = (bytes &gt; alignment || alignment &gt; 16) ? alignment : impl::power2[bytes];</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>      <span class="keywordflow">if</span>(<span class="keywordtype">size_t</span>(&amp;mem[offset]) % smallest_alignment != 0) { <span class="comment">// If we are currently unaligned.</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <span class="keywordtype">size_t</span> old_offset = offset;</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        offset += smallest_alignment - (size_t(&amp;mem[offset]) % smallest_alignment);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        unaligned_wasted_bytes += (offset - old_offset);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>      }</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>      assert(offset + bytes &lt;= capacity);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>      assert((<span class="keywordtype">size_t</span>)&amp;mem[offset] % smallest_alignment == 0);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>      <span class="keywordtype">void</span>* m = (<span class="keywordtype">void</span>*)&amp;mem[offset];</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>      offset += bytes;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>      num_allocations++;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>      <span class="keywordflow">return</span> m;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    }</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">void</span> deallocate(<span class="keywordtype">void</span>* ptr) {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>      <span class="keywordflow">if</span>(ptr != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        num_deallocations++;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      }</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    }</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  };</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  control_block* block;</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a553e27e397abe31c184b17dd70296001">  260</a></span>  <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a553e27e397abe31c184b17dd70296001">pool_allocator</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="foldopen" id="foldopen00262" data-start="{" data-end="}">
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#aa6d6cd933ebdd6ef4c8dde00e3ad441a">  262</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#aa6d6cd933ebdd6ef4c8dde00e3ad441a">pool_allocator</a>(<span class="keyword">const</span> <a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a>&amp; other):</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    block(other.block)</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <span class="keywordflow">if</span>(block != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>      block-&gt;counter++;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    }</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  }</div>
</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="foldopen" id="foldopen00270" data-start="{" data-end="}">
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#ad2b765dae488cd6a5abb33c1d80d6e5d">  270</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ad2b765dae488cd6a5abb33c1d80d6e5d">pool_allocator</a>(<a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a>&amp;&amp; other):</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    block(other.block)</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  {</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    other.block = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>  }</div>
</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="foldopen" id="foldopen00276" data-start="{" data-end="}">
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a48f133484d22075e1fd73bb3185e8a1a">  276</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a48f133484d22075e1fd73bb3185e8a1a">pool_allocator</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* mem, <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ad0c4251617512c5ecc69b13689134efa">capacity</a>, <span class="keywordtype">size_t</span> alignment = <span class="keyword">alignof</span>(std::max_align_t))</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>   : block(new control_block(mem, <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ad0c4251617512c5ecc69b13689134efa">capacity</a>, alignment))</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  {}</div>
</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">void</span> destroy() {</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    block-&gt;counter--;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordflow">if</span>(block-&gt;counter == 0) {</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>      <span class="comment">// This is a temporary hack to disable deleting the block when using Turbo...</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>      <span class="comment">// Unfortunately, there is a bug with -arch gpu and it seems the block is deleted from host while allocating on device (or vice-versa).</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="preprocessor">      #ifdef CUDA_THREADS_PER_BLOCK</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="preprocessor">      #else</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        <span class="keyword">delete</span> block;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="preprocessor">      #endif</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>  }</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00294" data-start="{" data-end="}">
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a06303d2df0d02737083552b298615068">  294</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a06303d2df0d02737083552b298615068">~pool_allocator</a>() {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="keywordflow">if</span>(block != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>      destroy();</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>  }</div>
</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="foldopen" id="foldopen00300" data-start="{" data-end="}">
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#aadbf18bbeca657bd6a167214a1c55ad9">  300</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a>&amp; <a class="code hl_function" href="classbattery_1_1pool__allocator.html#aadbf18bbeca657bd6a167214a1c55ad9">operator=</a>(<a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a>&amp;&amp; other) {</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="keywordflow">if</span>(block != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>      destroy();</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    }</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    block = other.block;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    other.block = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  }</div>
</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="foldopen" id="foldopen00309" data-start="{" data-end="}">
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#ab4fd5000109638d0b5acec882b6665e5">  309</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ab4fd5000109638d0b5acec882b6665e5">align_at</a>(<span class="keywordtype">size_t</span> alignment) {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="keywordtype">size_t</span> old = block-&gt;alignment;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    block-&gt;alignment = alignment;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="keywordflow">return</span> old;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>  }</div>
</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="foldopen" id="foldopen00315" data-start="{" data-end="}">
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a6a7dd0c1ab3b1211b1a0465aa9d83731">  315</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a6a7dd0c1ab3b1211b1a0465aa9d83731">allocate</a>(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordflow">return</span> block-&gt;allocate(bytes);</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>  }</div>
</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="foldopen" id="foldopen00319" data-start="{" data-end="}">
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a3a52a302349801db8410c48c174b6a1d">  319</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a3a52a302349801db8410c48c174b6a1d">deallocate</a>(<span class="keywordtype">void</span>* ptr) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    block-&gt;deallocate(ptr);</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>  }</div>
</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="foldopen" id="foldopen00323" data-start="{" data-end="}">
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#ad7bd0da918a461a19729698f4d712cc1">  323</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ad7bd0da918a461a19729698f4d712cc1">print</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="comment">// CUDA printf does not support &quot;%zu&quot; -- use PRIu64 macro (Windows / Linux)</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    printf(<span class="stringliteral">&quot;%% %&quot;</span> PRIu64 <span class="stringliteral">&quot; / %&quot;</span> PRIu64 <span class="stringliteral">&quot; used [%&quot;</span> PRIu64 <span class="stringliteral">&quot;/%&quot;</span> PRIu64 <span class="stringliteral">&quot;]KB [%&quot;</span> PRIu64 <span class="stringliteral">&quot;/%&quot;</span> PRIu64 <span class="stringliteral">&quot;]MB\n&quot;</span>,</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      block-&gt;offset, block-&gt;capacity,</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>      block-&gt;offset/1000, block-&gt;capacity/1000,</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>      block-&gt;offset/1000/1000, block-&gt;capacity/1000/1000);</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    printf(<span class="stringliteral">&quot;%% %&quot;</span> PRIu64 <span class="stringliteral">&quot; / %&quot;</span> PRIu64 <span class="stringliteral">&quot; wasted for alignment [%&quot;</span> PRIu64 <span class="stringliteral">&quot;/%&quot;</span> PRIu64 <span class="stringliteral">&quot;]KB [%&quot;</span> PRIu64 <span class="stringliteral">&quot;/%&quot;</span> PRIu64 <span class="stringliteral">&quot;]MB\n&quot;</span>,</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>      block-&gt;unaligned_wasted_bytes, block-&gt;offset,</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>      block-&gt;unaligned_wasted_bytes/1000, block-&gt;offset/1000,</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      block-&gt;unaligned_wasted_bytes/1000/1000, block-&gt;offset/1000/1000);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    printf(<span class="stringliteral">&quot;%% %&quot;</span> PRIu64 <span class="stringliteral">&quot; allocations and %&quot;</span> PRIu64 <span class="stringliteral">&quot; deallocations\n&quot;</span>, block-&gt;num_allocations, block-&gt;num_deallocations);</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>  }</div>
</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="foldopen" id="foldopen00336" data-start="{" data-end="}">
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a0f485861003e14846b56f31ad48cb356">  336</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a0f485861003e14846b56f31ad48cb356">used</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="keywordflow">return</span> block-&gt;offset;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>  }</div>
</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="foldopen" id="foldopen00340" data-start="{" data-end="}">
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#ad0c4251617512c5ecc69b13689134efa">  340</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#ad0c4251617512c5ecc69b13689134efa">capacity</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <span class="keywordflow">return</span> block-&gt;capacity;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  }</div>
</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="foldopen" id="foldopen00344" data-start="{" data-end="}">
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#afc015fad5ef8742afc69cab8e83d4882">  344</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#afc015fad5ef8742afc69cab8e83d4882">num_deallocations</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keywordflow">return</span> block-&gt;num_deallocations;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>  }</div>
</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="foldopen" id="foldopen00348" data-start="{" data-end="}">
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#aa171725b3e30029f66f96edc5567dc56">  348</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#aa171725b3e30029f66f96edc5567dc56">num_allocations</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordflow">return</span> block-&gt;num_allocations;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  }</div>
</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="foldopen" id="foldopen00352" data-start="{" data-end="}">
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#a958c31f074f5a6be04a65cfc14149881">  352</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#a958c31f074f5a6be04a65cfc14149881">unaligned_wasted_bytes</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="keywordflow">return</span> block-&gt;unaligned_wasted_bytes;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>  }</div>
</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="foldopen" id="foldopen00356" data-start="{" data-end="}">
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno"><a class="line" href="classbattery_1_1pool__allocator.html#aa30197fc8c814772f2c0b395ebbb603e">  356</a></span>  <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">bool</span> <a class="code hl_function" href="classbattery_1_1pool__allocator.html#aa30197fc8c814772f2c0b395ebbb603e">operator==</a>(<span class="keyword">const</span> <a class="code hl_class" href="classbattery_1_1pool__allocator.html">pool_allocator</a>&amp; rhs)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keywordflow">return</span> block == rhs.block;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>  }</div>
</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>};</div>
</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>}</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="foldopen" id="foldopen00362" data-start="{" data-end="}">
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno"><a class="line" href="allocator_8hpp.html#a10b36bda772147187f9346cd320c5635">  362</a></span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>(<span class="keywordtype">size_t</span> bytes, <a class="code hl_class" href="classbattery_1_1pool__allocator.html">battery::pool_allocator</a>&amp; p) {</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>  <span class="keywordflow">return</span> p.allocate(bytes);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>}</div>
</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span> </div>
<div class="foldopen" id="foldopen00366" data-start="{" data-end="}">
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno"><a class="line" href="allocator_8hpp.html#a63099a92325007898b0cbd5981ef1736">  366</a></span><a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>(<span class="keywordtype">void</span>* ptr, <a class="code hl_class" href="classbattery_1_1pool__allocator.html">battery::pool_allocator</a>&amp; p) {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>  <span class="keywordflow">return</span> p.deallocate(ptr);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>}</div>
</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacebattery.html">battery</a> {</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>  <span class="keyword">template</span> &lt;<span class="keyword">class</span> Allocator, <span class="keyword">class</span> InternalAllocator = Allocator&gt;</div>
<div class="foldopen" id="foldopen00372" data-start="{" data-end="};">
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html">  372</a></span>  <span class="keyword">class </span><a class="code hl_class" href="classbattery_1_1statistics__allocator.html">statistics_allocator</a> {</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="keyword">struct </span>control_block {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>      Allocator allocator;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      <span class="keywordtype">size_t</span> counter;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>      <span class="keywordtype">size_t</span> num_deallocations;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>      <span class="keywordtype">size_t</span> num_allocations;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>      <span class="keywordtype">size_t</span> total_bytes_allocated;</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>      <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> control_block(<span class="keyword">const</span> Allocator&amp; allocator)</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      : allocator(allocator), counter(1), num_deallocations(0), num_allocations(0), total_bytes_allocated(0)</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      {}</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>      <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* allocate(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        num_allocations++;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        total_bytes_allocated += bytes;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        <span class="keywordflow">return</span> allocator.allocate(bytes);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>      }</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>      <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> deallocate(<span class="keywordtype">void</span>* ptr) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        <span class="keywordflow">if</span>(ptr != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>          num_deallocations++;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>          allocator.deallocate(ptr);</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        }</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>      }</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    };</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    InternalAllocator internal_allocator;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    control_block* block;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  <span class="keyword">public</span>:</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a881f9585d731c7836a0b1e932a961159">  402</a></span>    <span class="keyword">using </span><a class="code hl_class" href="classbattery_1_1statistics__allocator.html">this_type</a> = <a class="code hl_class" href="classbattery_1_1statistics__allocator.html">statistics_allocator&lt;Allocator, InternalAllocator&gt;</a>;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="foldopen" id="foldopen00404" data-start="{" data-end="}">
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a0e44ecdcde5f757acd8213fab559f875">  404</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a0e44ecdcde5f757acd8213fab559f875">statistics_allocator</a>(<span class="keyword">const</span> <a class="code hl_class" href="classbattery_1_1statistics__allocator.html">statistics_allocator</a>&amp; other)</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>      : internal_allocator(other.internal_allocator), block(other.block)</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>      block-&gt;counter++;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    }</div>
</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="foldopen" id="foldopen00410" data-start="{" data-end="}">
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a994d5514c1fbefbd26ae1a34a54ce506">  410</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a994d5514c1fbefbd26ae1a34a54ce506">statistics_allocator</a>(<span class="keyword">const</span> Allocator&amp; allocator = Allocator(), <span class="keyword">const</span> InternalAllocator&amp; internal_allocator = InternalAllocator())</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>      : internal_allocator(internal_allocator)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    {</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>      block = <span class="keyword">static_cast&lt;</span>control_block*<span class="keyword">&gt;</span>(this-&gt;internal_allocator.allocate(<span class="keyword">sizeof</span>(control_block)));</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>      <span class="keyword">new</span>(block) control_block(allocator);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    }</div>
</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="foldopen" id="foldopen00417" data-start="{" data-end="}">
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#abf8507c19f41784ffae31685455041e3">  417</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#abf8507c19f41784ffae31685455041e3">~statistics_allocator</a>() {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>      block-&gt;counter--;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>      <span class="keywordflow">if</span>(block-&gt;counter == 0) {</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        internal_allocator.deallocate(block);</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>      }</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    }</div>
</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="foldopen" id="foldopen00424" data-start="{" data-end="}">
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a7a794eaf47035946650086ba4eb7dcf2">  424</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span>* <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a7a794eaf47035946650086ba4eb7dcf2">allocate</a>(<span class="keywordtype">size_t</span> bytes) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>      <span class="keywordflow">return</span> block-&gt;allocate(bytes);</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    }</div>
</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="foldopen" id="foldopen00428" data-start="{" data-end="}">
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#aa60de79e7df795fd3c443e67340b0266">  428</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <a class="code hl_define" href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a> <span class="keywordtype">void</span> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#aa60de79e7df795fd3c443e67340b0266">deallocate</a>(<span class="keywordtype">void</span>* ptr) {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      block-&gt;deallocate(ptr);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    }</div>
</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span> </div>
<div class="foldopen" id="foldopen00432" data-start="{" data-end="}">
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#af98303e76e95a5f12e6ecce2e615e61a">  432</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#af98303e76e95a5f12e6ecce2e615e61a">num_allocations</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>      <span class="keywordflow">return</span> block-&gt;num_allocations;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    }</div>
</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="foldopen" id="foldopen00436" data-start="{" data-end="}">
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a142cba1058499974191021e9561be2f3">  436</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a142cba1058499974191021e9561be2f3">num_deallocations</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>      <span class="keywordflow">return</span> block-&gt;num_deallocations;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    }</div>
</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="foldopen" id="foldopen00440" data-start="{" data-end="}">
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a8977f3dedaddf754b600797b74fae109">  440</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a8977f3dedaddf754b600797b74fae109">total_bytes_allocated</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      <span class="keywordflow">return</span> block-&gt;total_bytes_allocated;</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    }</div>
</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="foldopen" id="foldopen00444" data-start="{" data-end="}">
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno"><a class="line" href="classbattery_1_1statistics__allocator.html#a540b5b47d08489d194f1b8b5a4c46740">  444</a></span>    <a class="code hl_define" href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classbattery_1_1statistics__allocator.html#a540b5b47d08489d194f1b8b5a4c46740">operator==</a>(<span class="keyword">const</span> <a class="code hl_class" href="classbattery_1_1statistics__allocator.html">this_type</a>&amp; rhs)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>      <span class="keywordflow">return</span> block == rhs.block;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    }</div>
</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  };</div>
</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>}</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html"><div class="ttname"><a href="classbattery_1_1pool__allocator.html">battery::pool_allocator</a></div><div class="ttdef"><b>Definition</b> allocator.hpp:215</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a06303d2df0d02737083552b298615068"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a06303d2df0d02737083552b298615068">battery::pool_allocator::~pool_allocator</a></div><div class="ttdeci">CUDA NI ~pool_allocator()</div><div class="ttdef"><b>Definition</b> allocator.hpp:294</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a0f485861003e14846b56f31ad48cb356"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a0f485861003e14846b56f31ad48cb356">battery::pool_allocator::used</a></div><div class="ttdeci">CUDA size_t used() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:336</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a3a52a302349801db8410c48c174b6a1d"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a3a52a302349801db8410c48c174b6a1d">battery::pool_allocator::deallocate</a></div><div class="ttdeci">CUDA NI void deallocate(void *ptr)</div><div class="ttdef"><b>Definition</b> allocator.hpp:319</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a48f133484d22075e1fd73bb3185e8a1a"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a48f133484d22075e1fd73bb3185e8a1a">battery::pool_allocator::pool_allocator</a></div><div class="ttdeci">CUDA NI pool_allocator(unsigned char *mem, size_t capacity, size_t alignment=alignof(std::max_align_t))</div><div class="ttdef"><b>Definition</b> allocator.hpp:276</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a553e27e397abe31c184b17dd70296001"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a553e27e397abe31c184b17dd70296001">battery::pool_allocator::pool_allocator</a></div><div class="ttdeci">NI pool_allocator()=default</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a6a7dd0c1ab3b1211b1a0465aa9d83731"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a6a7dd0c1ab3b1211b1a0465aa9d83731">battery::pool_allocator::allocate</a></div><div class="ttdeci">CUDA NI void * allocate(size_t bytes)</div><div class="ttdef"><b>Definition</b> allocator.hpp:315</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_a958c31f074f5a6be04a65cfc14149881"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#a958c31f074f5a6be04a65cfc14149881">battery::pool_allocator::unaligned_wasted_bytes</a></div><div class="ttdeci">CUDA size_t unaligned_wasted_bytes() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:352</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_aa171725b3e30029f66f96edc5567dc56"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#aa171725b3e30029f66f96edc5567dc56">battery::pool_allocator::num_allocations</a></div><div class="ttdeci">CUDA size_t num_allocations() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:348</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_aa30197fc8c814772f2c0b395ebbb603e"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#aa30197fc8c814772f2c0b395ebbb603e">battery::pool_allocator::operator==</a></div><div class="ttdeci">CUDA bool operator==(const pool_allocator &amp;rhs) const</div><div class="ttdef"><b>Definition</b> allocator.hpp:356</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_aa6d6cd933ebdd6ef4c8dde00e3ad441a"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#aa6d6cd933ebdd6ef4c8dde00e3ad441a">battery::pool_allocator::pool_allocator</a></div><div class="ttdeci">CUDA NI pool_allocator(const pool_allocator &amp;other)</div><div class="ttdef"><b>Definition</b> allocator.hpp:262</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_aadbf18bbeca657bd6a167214a1c55ad9"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#aadbf18bbeca657bd6a167214a1c55ad9">battery::pool_allocator::operator=</a></div><div class="ttdeci">CUDA NI pool_allocator &amp; operator=(pool_allocator &amp;&amp;other)</div><div class="ttdef"><b>Definition</b> allocator.hpp:300</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_ab4fd5000109638d0b5acec882b6665e5"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#ab4fd5000109638d0b5acec882b6665e5">battery::pool_allocator::align_at</a></div><div class="ttdeci">CUDA size_t align_at(size_t alignment)</div><div class="ttdef"><b>Definition</b> allocator.hpp:309</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_ad0c4251617512c5ecc69b13689134efa"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#ad0c4251617512c5ecc69b13689134efa">battery::pool_allocator::capacity</a></div><div class="ttdeci">CUDA size_t capacity() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:340</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_ad2b765dae488cd6a5abb33c1d80d6e5d"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#ad2b765dae488cd6a5abb33c1d80d6e5d">battery::pool_allocator::pool_allocator</a></div><div class="ttdeci">CUDA NI pool_allocator(pool_allocator &amp;&amp;other)</div><div class="ttdef"><b>Definition</b> allocator.hpp:270</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_ad7bd0da918a461a19729698f4d712cc1"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#ad7bd0da918a461a19729698f4d712cc1">battery::pool_allocator::print</a></div><div class="ttdeci">CUDA NI void print() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:323</div></div>
<div class="ttc" id="aclassbattery_1_1pool__allocator_html_afc015fad5ef8742afc69cab8e83d4882"><div class="ttname"><a href="classbattery_1_1pool__allocator.html#afc015fad5ef8742afc69cab8e83d4882">battery::pool_allocator::num_deallocations</a></div><div class="ttdeci">CUDA size_t num_deallocations() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:344</div></div>
<div class="ttc" id="aclassbattery_1_1standard__allocator_html"><div class="ttname"><a href="classbattery_1_1standard__allocator.html">battery::standard_allocator</a></div><div class="ttdef"><b>Definition</b> allocator.hpp:25</div></div>
<div class="ttc" id="aclassbattery_1_1standard__allocator_html_aa718ff577c1ebfa1088dc182a89d3a4d"><div class="ttname"><a href="classbattery_1_1standard__allocator.html#aa718ff577c1ebfa1088dc182a89d3a4d">battery::standard_allocator::deallocate</a></div><div class="ttdeci">CUDA NI void deallocate(void *data)</div><div class="ttdef"><b>Definition</b> allocator.hpp:34</div></div>
<div class="ttc" id="aclassbattery_1_1standard__allocator_html_ae2ec671ca402535a48e2a02d8aad22c0"><div class="ttname"><a href="classbattery_1_1standard__allocator.html#ae2ec671ca402535a48e2a02d8aad22c0">battery::standard_allocator::operator==</a></div><div class="ttdeci">CUDA bool operator==(const standard_allocator &amp;) const</div><div class="ttdef"><b>Definition</b> allocator.hpp:38</div></div>
<div class="ttc" id="aclassbattery_1_1standard__allocator_html_af9afc67980d82a6a03873125cacc2b80"><div class="ttname"><a href="classbattery_1_1standard__allocator.html#af9afc67980d82a6a03873125cacc2b80">battery::standard_allocator::allocate</a></div><div class="ttdeci">CUDA NI void * allocate(size_t bytes)</div><div class="ttdef"><b>Definition</b> allocator.hpp:27</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html">battery::statistics_allocator</a></div><div class="ttdef"><b>Definition</b> allocator.hpp:372</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a0e44ecdcde5f757acd8213fab559f875"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a0e44ecdcde5f757acd8213fab559f875">battery::statistics_allocator::statistics_allocator</a></div><div class="ttdeci">CUDA NI statistics_allocator(const statistics_allocator &amp;other)</div><div class="ttdef"><b>Definition</b> allocator.hpp:404</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a142cba1058499974191021e9561be2f3"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a142cba1058499974191021e9561be2f3">battery::statistics_allocator::num_deallocations</a></div><div class="ttdeci">CUDA size_t num_deallocations() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:436</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a540b5b47d08489d194f1b8b5a4c46740"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a540b5b47d08489d194f1b8b5a4c46740">battery::statistics_allocator::operator==</a></div><div class="ttdeci">CUDA bool operator==(const this_type &amp;rhs) const</div><div class="ttdef"><b>Definition</b> allocator.hpp:444</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a7a794eaf47035946650086ba4eb7dcf2"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a7a794eaf47035946650086ba4eb7dcf2">battery::statistics_allocator::allocate</a></div><div class="ttdeci">CUDA NI void * allocate(size_t bytes)</div><div class="ttdef"><b>Definition</b> allocator.hpp:424</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a8977f3dedaddf754b600797b74fae109"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a8977f3dedaddf754b600797b74fae109">battery::statistics_allocator::total_bytes_allocated</a></div><div class="ttdeci">CUDA size_t total_bytes_allocated() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:440</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_a994d5514c1fbefbd26ae1a34a54ce506"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#a994d5514c1fbefbd26ae1a34a54ce506">battery::statistics_allocator::statistics_allocator</a></div><div class="ttdeci">CUDA NI statistics_allocator(const Allocator &amp;allocator=Allocator(), const InternalAllocator &amp;internal_allocator=InternalAllocator())</div><div class="ttdef"><b>Definition</b> allocator.hpp:410</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_aa60de79e7df795fd3c443e67340b0266"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#aa60de79e7df795fd3c443e67340b0266">battery::statistics_allocator::deallocate</a></div><div class="ttdeci">CUDA NI void deallocate(void *ptr)</div><div class="ttdef"><b>Definition</b> allocator.hpp:428</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_abf8507c19f41784ffae31685455041e3"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#abf8507c19f41784ffae31685455041e3">battery::statistics_allocator::~statistics_allocator</a></div><div class="ttdeci">CUDA NI ~statistics_allocator()</div><div class="ttdef"><b>Definition</b> allocator.hpp:417</div></div>
<div class="ttc" id="aclassbattery_1_1statistics__allocator_html_af98303e76e95a5f12e6ecce2e615e61a"><div class="ttname"><a href="classbattery_1_1statistics__allocator.html#af98303e76e95a5f12e6ecce2e615e61a">battery::statistics_allocator::num_allocations</a></div><div class="ttdeci">CUDA size_t num_allocations() const</div><div class="ttdef"><b>Definition</b> allocator.hpp:432</div></div>
<div class="ttc" id="anamespacebattery_html"><div class="ttname"><a href="namespacebattery.html">battery</a></div><div class="ttdef"><b>Definition</b> algorithm.hpp:10</div></div>
<div class="ttc" id="anamespacebattery_html_af20bf52da412236ddfa5a22bde3f50e6"><div class="ttname"><a href="namespacebattery.html#af20bf52da412236ddfa5a22bde3f50e6">battery::operator==</a></div><div class="ttdeci">CUDA bool operator==(const string&lt; Alloc1 &gt; &amp;lhs, const string&lt; Alloc2 &gt; &amp;rhs)</div><div class="ttdef"><b>Definition</b> string.hpp:110</div></div>
<div class="ttc" id="autility_8hpp_html"><div class="ttname"><a href="utility_8hpp.html">utility.hpp</a></div></div>
<div class="ttc" id="autility_8hpp_html_a7b01e29f669d6beed251f1b2a547ca93"><div class="ttname"><a href="utility_8hpp.html#a7b01e29f669d6beed251f1b2a547ca93">CUDA</a></div><div class="ttdeci">#define CUDA</div><div class="ttdef"><b>Definition</b> utility.hpp:59</div></div>
<div class="ttc" id="autility_8hpp_html_a860bedb684529775463fa3a6cb467efa"><div class="ttname"><a href="utility_8hpp.html#a860bedb684529775463fa3a6cb467efa">NI</a></div><div class="ttdeci">#define NI</div><div class="ttdef"><b>Definition</b> utility.hpp:62</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_0f9b23599b40747f02a3580542ed218a.html">battery</a></li><li class="navelem"><a class="el" href="allocator_8hpp.html">allocator.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
